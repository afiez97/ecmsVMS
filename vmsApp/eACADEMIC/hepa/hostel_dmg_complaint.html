<!-- HEADER INSERT -->
<div class="app-header white bg b-b">
  <div class="navbar" data-pjax>
    <a data-toggle="modal" data-target="#aside" class="navbar-item pull-left hidden-lg-up p-r m-a-0">
      <i class="ion-navicon"></i>
    </a>

    <ul class="nav navbar-nav">
      <li class="nav-item">
        <span class="navbar-item text-md">DAMAGE COMPLAINT</span>
      </li>
      <!-- <li class="nav-item">
				        <a class="nav-link text-muted" data-toggle="modal" data-target="#modalAdd">
				            <span class="">
				            	<i class="fa fa-fw fa-plus"></i>
				            	<span class="hidden-sm-down">New Record</span>
				            </span>
				        </a>
			        </li> -->
    </ul>
    <!-- nabar right -->
    <!-- <ul class="nav navbar-nav pull-right" id="template-header">
      <li id="generatePdfButton" style="cursor: pointer;" class="nav-item">
        <span class="navbar-item text-md"><i class="fa fa-fw fa-pencil-square-o"></i>Reporting</span>
      </li>
    </ul> -->
  </div>
</div>

<!-- FOOTER INSERT  -->
<div class="app-footer white bg p-a b-t" id="template-footer"> </div>

<div class="app-body">

  <!-- CONTENT START -->
  <div style="min-height: mh-200">
    <div class="col-md-10 offset-md-1 mt-2">
      <div class="box">
        <div class="box-header blue-700">
          <!-- <span class="label pull-right"><i class="fa fa-fw fa-pencil-square-o"></i>Reporting Damage Compaint</span> -->

          <h3><b>Damage Complaint</b></h3>
        </div>

        <div class="box-body ">
          <p class="m-a-0">
          <div id="tableaduanResponden">
            <textarea class="hidden" id="dataList"></textarea>
            <table id="aduanResponden" class="table table-striped m-b-none"></table>
          </div>
          </p>
        </div>
      </div>

      <!-------------------------------------------------- modal update Aduan -------------------------------------------------->
      <div id="modalUpdate" class="modal fade" data-backdrop="static">
        <div class="modal-dialog modal-lg">
          <div class="modal-content" id="">
            <form role="form" id="formUptReport">
              <div class="modal-header blue-700">
                <h5 class="modal-title">UPDATE COMPLAINT</h5>
              </div>

              <div class="modal-body p-lg">
                <!-- <div class="row m-t-1">
                                <div class="col-md-6">
                                  <input type="hidden" id="pk_id">
                                  <div class="form-group row">
                                    <label for="" class="col-sm-3 form-control-label ">Campus<span class="text-danger"> *</span></label>
                                    <div class="col-sm-9">
                                      <select class="form-control c-select" id="upt_clg_id" required></select>
                                    </div>
                                  </div>

                                  <div class="form-group row ">
                                    <label for="" class="col-sm-3 form-control-label ">Matric No.<span class="text-danger"> *</span></label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="upt_stud_icno" placeholder="Matric No." required>
                                    </div>
                                  </div>

                                  <div class="form-group row">
                                    <label for="" class="col-sm-3 form-control-label ">Venue</label>
                                    <div class="col-sm-9">
                                      <input type="text" class="form-control" id="upt_aduan_venue" placeholder="Venue">
                                    </div>
                                  </div>

                                  <div class="form-group row ">
                                    <label for="" class="col-sm-3 form-control-label ">Remark</label>
                                    <div class="col-sm-9">
                                      <textarea class="form-control" rows="5" id="upt_aduan_remark" placeholder="Remark"></textarea>
                                    </div>
                                  </div>
                                </div>

                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label for="" class="col-sm-3 form-control-label ">Type<span class="text-danger"> *</span></label>
                                    <div class="col-sm-9">
                                      <select class="form-control c-select" id="upt_aduan_type" disabled></select>
                                    </div>
                                  </div>

                                  <div class="form-group row">
                                    <label for="" class="col-sm-3 form-control-label">Date</label>
                                    <div class="col-sm-9">
                                      <input type="date" class="form-control" id="upt_aduan_date" placeholder="Date">
                                    </div>
                                  </div>   

                                  <div class="form-group row">
                                    <label class="col-sm-3 form-control-label ">Upload</label>
                                    <div class="col-sm-9">
                                      <div class="row">
                                        <div class="col-md-2">
                                          <span id="view_aduan_upload"></span>
                                        </div>
                                        <div class="col-md-10 p-l-0"><input type="file" class="form-control chkFormat" id="upt_aduan_upload"></div>
                                      </div>
                                      <input type="hidden" class="form-control" id="exist_aduan_upload">
                                    </div>
                                  </div>

                                  <div class="form-group row">
                                    <label for="" class="col-sm-3 form-control-label ">Status</label>
                                    <div class="col-sm-9">
                                      <select class="form-control c-select" id="upt_aduan_status">
                                        <option value="">- Choose -</option>
                                        <option value="New">New</option>
                                        <option value="Accept">Accept</option>
                                        <option value="Complete">Complete</option>
                                      </select>
                                    </div>
                                  </div>

                                  <div class="form-group row divUptKerosakan">
                                    <label for="" class="col-sm-3 form-control-label ">Warden Assigned</label>
                                    <div class="col-sm-9">
                                      <select class="form-control c-select slct2" id="aduan_warden_assigned"></select>
                                    </div>
                                  </div>
                                </div>
                              </div> -->

                <p>
                  <input type="hidden" id="upt_aduanId">

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Campus</div>
                  <div class="col-sm-9 text-uppercase" id="upt_FK_clg"></div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Student</div>
                  <div class="col-sm-9 text-uppercase" id="upt_StudentDet"></div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Room</div>
                  <div class="col-sm-9"><span class="label grey" id="upt_FK_room"></span></div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Type Complaint</div>
                  <div class="col-sm-9 text-uppercase" id="upt_FK_jenisaduanHostel"></div>
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Details Complaint</div>
                  <div class="col-sm-9 text-uppercase" id="upt_aduan_details"></div>
                </div>



                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Reference</div>
                  <div class="col-sm-9" id="upt_aduan_upload"></div>

                  <!-- <div class="col-sm-9"><input type="file" class="form-control chkFormat" id="upt_aduan_upload"></div> -->
                </div>

                <div class="form-group row">
                  <div class="col-sm-3 font-weight-bold">Date/Time</div>
                  <div class="col-sm-9 text-uppercase" id="upt_aduan_date"></div>
                </div>
                <hr>

                <!------------------------------ form update status ------------------------------>
                <input type="hidden" id="coun_id">
                <div class="form-group row">
                  <label class="col-sm-3 font-weight-bold">Status</label>
                  <div class="col-sm-9">
                    <select class="form-control c-select" id="upt_aduan_status" required>
                      <option value="">- Choose -</option>
                      <option value="New">New</option>
                      <option value="Accept">Accept</option>
                      <option value="Reject">Reject</option>
                      <option value="Complete">Complete</option>
                    </select>
                  </div>
                </div>

                <div class="form-group row">
                  <label class="col-sm-3 font-weight-bold">Remarks</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control formUptStts" id="aduan_warden_remark" required>
                  </div>
                </div>

                <div class="form-group row" title="Select Counselor & Date to view list">
                  <label class="col-sm-3 font-weight-bold">Person In Charge<span class="text-info"> *</span></label>
                  <div class="col-sm-9">
                    <select class="form-control c-select formUptStts" id="aduan_warden_assigned" required></select>
                  </div>
                </div>

                <!-- <div class="form-group row">
                                  <div class="col-sm-3 font-weight-bold">Status Complaint</div>
                                  <div class="col-sm-9 text-uppercase" id="upt_aduan_status"></div>
                                </div> -->



                <!------------------------------ end form update status ------------------------------>

                </p>
              </div>

              <div class="modal-footer ">
                <button type="button" class="btn white p-x-md" data-dismiss="modal">Cancel</button>
                <input type="submit" class="btn success p-x-md" value="Update">
              </div>
            </form>
          </div><!-- /.modal-content -->
        </div>
      </div>
      <!-------------------------------------------------- end modal update Aduan -------------------------------------------------->


      <!-------------------------------------------------- modal view Aduan -------------------------------------------------->
      <div id="modalView" class="modal fade" data-backdrop="static">
        <div class="modal-dialog">
          <div class="modal-content" id="">
            <div class="modal-header blue-700">
              <h5 class="modal-title">VIEW DAMAGE COMPLAINT</h5>
            </div>
            <form id="formUptComplete">
              <div class="modal-body p-lg">
                <p>
                  <input type="hidden" id="view_aduanId">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Campus</div>
                      <div class="col-sm-9 text-uppercase" id="view_clg_id"></div>
                    </div>

                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Type</div>
                      <div class="col-sm-9 text-uppercase" id="view_FK_jenisaduanHostel"></div>
                    </div>

                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Date</div>
                      <div class="col-sm-9" id="view_aduan_date"></div>
                    </div>

                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Venue</div>
                      <div class="col-sm-9 text-uppercase" id="view_aduan_venue"></div>
                    </div>

                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Upload</div>
                      <div class="col-sm-9" id="view_upload"></div>
                    </div>

                    <div class="form-group row">
                      <div class="col-sm-3 font-weight-bold">Remark</div>
                      <div class="col-sm-9 text-uppercase" id="view_aduan_remark"></div>
                    </div>

                    <div class="form-group row m-b-0 ">
                      <div class="col-sm-3 font-weight-bold">Status</div>
                      <div class="col-sm-9" id="view_aduan_status"></div>
                    </div>

                    <div class="form-group row m-t-1 ">
                      <div class="col-sm-3 font-weight-bold">Warden Assigned</div>
                      <div class="col-sm-9 text-uppercase" id="view_aduan_warden_assigned"></div>
                    </div>

                    <div class="form-group row m-b-0 ">
                      <div class="col-sm-3 font-weight-bold">Warden Remark</div>
                      <div class="col-sm-9 text-uppercase" id="view_aduan_warden_remark"></div>
                    </div>
                  </div>
                </div>
                </p>
              </div>

              <div class="modal-footer ">
                <button type="button" class="btn white p-x-md" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn success p-x-md divRemarkKerosakan">Complete</button>
              </div>
            </form>
          </div><!-- /.modal-content -->
        </div>
      </div>
      <!-------------------------------------------------- end modal view Aduan -------------------------------------------------->

    </div>
  </div>
</div>


<script src="scripts/jspdf.umd.min.js"></script>
<script src="scripts/jspdf.plugin.autotable.js"></script>
<script src="callFunction.js"></script>
<script src="scripts/ajax.js"></script>
<script src="hostel_dmg_complaint.js"></script>
<script>
  $(document).ready(function () {
    $('#generatePdfButton').click(function () {
      GeneratePDFUnitDmg('DAMAGE COMPLAINT', 'aduanResponden', 'UNIT PENGURUSAN HOSTEL');
    });
  });



  function GeneratePDFUnitDmg(name, idTable, nameUnit) {
    window.jsPDF = window.jspdf.jsPDF; // Ensure to call the jsPDF library

    var doc = new jsPDF({
      orientation: "landscape",
      unit: "mm",
      format: "a4",
    });

    // Set the margin.bottom property to add space between the table and the footer image
    var tableMargin = { top: 40, bottom: 40 }; // You can adjust these values as needed

    // Variable to track the starting Y position on subsequent pages
    var subsequentPageStartY = 100;

    // Function to add the header content to each page
    function addHeader() {
      // Create a gradient effect with three colors (purple, maroon, red) on the left side
      var gradientColors = ['#743d89', '#973d78', '#ac3869'];
      var gradientWidth = 1.4; // Width of each color segment
      var gradientHeight = doc.internal.pageSize.height;

      for (var i = 0; i < gradientColors.length; i++) {
        doc.setFillColor(gradientColors[i]);
        doc.rect(i * gradientWidth, 0, gradientWidth, gradientHeight, 'F');
      }

      var a4Width = 210;

      // Image dimensions
      var originalWidth = 275.59; // Replace with the actual width of your image
      var originalHeight = 67.818; // Replace with the actual height of your image

      // Calculate the new width and height (60% of A4 width while maintaining aspect ratio)
      var newWidth = 0.6 * a4Width;
      var newHeight = (newWidth / originalWidth) * originalHeight;

      // Calculate the X-coordinate to center the image on the A4 page
      var xCoordinate = (a4Width - newWidth) / 2;

      // Add the image to the document with the calculated width, height, and centered position
      doc.addImage("images/logo_reporting.png", "JPEG", xCoordinate, 10, newWidth, newHeight);

      doc.setFont("helvetica", "bold");
      var textCenterX = doc.internal.pageSize.width / 2;
      doc.setFontSize(14); // Set the font size to 10
      doc.text('BAHAGIAN HAL EHWAL PELAJAR DAN ALUMNI', textCenterX, 50, { align: "center" });

      doc.setFont("helvetica", "bold");
      doc.setFontSize(13); // Set the font size to 8
      doc.text(nameUnit, textCenterX, 58, { align: "center" });

      const text = "REPORTING " + name;
      doc.setFontSize(15);
      // Set the font type for the text
      doc.setFont("helvetica", "bold");
      const textWidth = doc.getTextWidth(text);
      // Set the position for the text
      const textX = 20; // X position
      const textY = 80; // Y position

      doc.text(text, textX, textY);

      // Set the underline color
      doc.setDrawColor(0, 0, 0); // RGB color for the underline

      // Draw the original-size underline
      const underlineLength1 = textWidth + 20; // Length of the underline
      const underlineWidth1 = 1.5; // Width of the underline
      doc.setLineWidth(underlineWidth1);
      doc.line(textX, textY + 2, textX + underlineLength1, textY + 2);

      // Set the color for the second underline (purple)
      doc.setDrawColor(128, 0, 128); // RGB color for purple

      // Draw the second underline with double the width
      const underlineLength2 = textWidth * (30 / 100); // Same length as the first underline
      const underlineWidth2 = underlineWidth1 * 2; // Double the width
      doc.setLineWidth(underlineWidth2);
      doc.line(textX, textY + 2, textX + underlineLength2, textY + 2);
    }


    // Function to add the footer to each page
    function addFooter() {
      doc.addImage("images/footer_reporting.png", "JPEG", 6, 276, 200, 20);
    }

    // Function to add the content (table) to each page
    function addContent() {

      //nie utk buang filter tu
      $('#' + idTable + ' thead .footable-filtering').empty();

      // Check if the last header column is labeled as 'Action'
      var removeLastColumn = ($('#' + idTable + ' thead th:last-child').text().trim() === 'Action');

      // Hide the last header column if it's labeled as 'Action'
      if (removeLastColumn) {
        $('#' + idTable + ' thead th:last-child').hide();
      }

      // Hide the last column from each row if the last header column is labeled as 'Action'
      if (removeLastColumn) {
        $('#' + idTable + ' tbody tr').each(function () {
          $(this).find('td:last-child').hide();
        });
      }
      var source = $('#' + idTable)[0];

      var pageHeight = doc.internal.pageSize.height;

      if (doc.y + tableMargin.bottom + tableMargin.top + tableMargin.top > pageHeight) {
        // Not enough space for the content on the current page
        addPage();
      }

      // doc.autoTable({
      //     html: source,
      //     startY: subsequentPageStartY, // Fixed startY for all pages
      //     margin: tableMargin,
      //     theme: 'grid',
      //     styles: { fillColor: false, textColor: 0 },
      //     headStyles: { fillColor: '#9c4298', textColor: 255 },
      // });
      doc.autoTable({
        html: source,
        startY: subsequentPageStartY,
        margin: tableMargin,
        theme: 'grid',
        styles: { fillColor: false, textColor: 0 },
        headStyles: { fillColor: '#9c4298', textColor: 255, halign: 'center' }, // Set halign to 'center' for center alignment
        columnStyles: {
          1: { // Index 1 corresponds to the second column (0-based index)
            columnWidth: 40 // Set the desired width for the "Location" column

          },
        },
        didParseCell: function (data) {
          if (data.column.index === 1 && data.cell.raw === "") {
            // Manually set the width of the cell in the "Location" column
            data.cell.styles.cellWidth = 40;

          }
        },
      });
    }

    // Function to add a new page with header and footer
    function addPage() {
      doc.addPage();
      addHeader();
      addFooter();
      subsequentPageStartY = 80; // Reset startY for the new page
    }

    // Add the first page with header and footer
    addHeader();
    addContent(); // Adding the table content
    addFooter();

    // Save the document
    doc.save('Reporting_' + name + '.pdf');
  }   
</script>